{"ID":"20250605215012-k7slxew","Spec":"1","Type":"NodeDocument","Properties":{"id":"20250605215012-k7slxew","title":"插桩","type":"doc","updated":"20250605215017"},"Children":[{"ID":"20250605215017-7oas7rb","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250605215017-7oas7rb","updated":"20250605215017"},"Children":[{"Type":"NodeText","Data":"一、插桩是什么？"}]},{"ID":"20250605215017-8qwmrc9","Type":"NodeParagraph","Properties":{"id":"20250605215017-8qwmrc9","updated":"20250605215017"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"插桩（Instrumentation）是一种在程序中插入额外代码"},{"Type":"NodeText","Data":"的技术，目的是在"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"不改变程序原有业务逻辑的前提下"},{"Type":"NodeText","Data":"，实现对程序行为的监控、分析或控制。"}]},{"ID":"20250605215017-s4fqbar","Type":"NodeParagraph","Properties":{"id":"20250605215017-s4fqbar","updated":"20250605215017"},"Children":[{"Type":"NodeText","Data":"这些插入的代码称为"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"*"}]},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"*"}]},{"Type":"NodeText","Data":"“探针（probe）”"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"*"}]},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"*"}]},{"Type":"NodeText","Data":"，它们通常用于记录程序的状态（如变量值、执行路径、时间等），或者引导测试行为（如模拟故障、采集覆盖率等）。"}]},{"ID":"20250605215017-g9510a4","Type":"NodeThematicBreak","Properties":{"id":"20250605215017-g9510a4","updated":"20250605215017"}},{"ID":"20250605215017-32e2zch","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250605215017-32e2zch","updated":"20250605215017"},"Children":[{"Type":"NodeText","Data":"二、插桩的分类"}]},{"ID":"20250605215017-o3y05hi","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250605215017-o3y05hi","updated":"20250605215017"},"Children":[{"Type":"NodeText","Data":"1. 按插入时机分类"}]},{"ID":"20250605215017-mpafavp","Type":"NodeTable","TableAligns":[0,0,0,0],"Properties":{"colgroup":"|||","id":"20250605215017-mpafavp","updated":"20250605215017"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"类型"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"描述"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"优点"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"缺点"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"源代码级插桩（Source-level Instrumentation）"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"在源代码层面插入探针"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"灵活，易读"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"需源码，侵入性较强"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"字节码级插桩（Bytecode-level Instrumentation）"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"对Java等字节码进行插桩"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"无需源码，跨平台"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"对初学者理解成本高"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"二进制级插桩（Binary Instrumentation）"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"对编译后的二进制程序插桩（如 ELF 文件）"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"无源码也能使用"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"技术复杂，调试困难"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"运行时插桩（Dynamic Instrumentation）"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"程序运行时插入探针（如用Pin、DTrace）"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"不影响构建流程"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"性能开销较大，复杂"}]}]}]},{"ID":"20250605215017-mu41eto","Type":"NodeThematicBreak","Properties":{"id":"20250605215017-mu41eto","updated":"20250605215017"}},{"ID":"20250605215017-403dtyh","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250605215017-403dtyh","updated":"20250605215017"},"Children":[{"Type":"NodeText","Data":"三、插桩的常见应用场景"}]},{"ID":"20250605215017-w0u0kuk","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250605215017-w0u0kuk","updated":"20250605215017"},"Children":[{"Type":"NodeText","Data":"1. "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"软件测试"}]},{"ID":"20250605215017-nxu6wrm","Type":"NodeList","ListData":{},"Properties":{"id":"20250605215017-nxu6wrm","updated":"20250605215017"},"Children":[{"ID":"20250605215017-e7zbp61","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250605215017-e7zbp61","updated":"20250605215017"},"Children":[{"ID":"20250605215017-bcht3yd","Type":"NodeParagraph","Properties":{"id":"20250605215017-bcht3yd","updated":"20250605215017"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"覆盖率分析"},{"Type":"NodeText","Data":"：插桩收集哪些代码被执行了（如Gcov、JaCoCo、Emma、Coverage.py等）"}]}]},{"ID":"20250605215017-8lrqqpm","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250605215017-8lrqqpm","updated":"20250605215017"},"Children":[{"ID":"20250605215017-16rtw64","Type":"NodeParagraph","Properties":{"id":"20250605215017-16rtw64","updated":"20250605215017"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"断言插桩"},{"Type":"NodeText","Data":"：插入断言语句进行检查（如形参不为 null，某变量值在合理范围内）"}]}]},{"ID":"20250605215017-91ypgsr","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250605215017-91ypgsr","updated":"20250605215017"},"Children":[{"ID":"20250605215017-xzsaipq","Type":"NodeParagraph","Properties":{"id":"20250605215017-xzsaipq","updated":"20250605215017"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"路径跟踪"},{"Type":"NodeText","Data":"：记录程序的分支路径或基本块（basic block）执行顺序"}]}]},{"ID":"20250605215017-ui5pl65","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250605215017-ui5pl65","updated":"20250605215017"},"Children":[{"ID":"20250605215017-p7icri9","Type":"NodeParagraph","Properties":{"id":"20250605215017-p7icri9","updated":"20250605215017"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"自动化测试"},{"Type":"NodeText","Data":"：结合插桩与Fuzzing、符号执行、Metamorphic Testing提高效率与精度"}]}]}]},{"ID":"20250605215017-bwfgy21","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250605215017-bwfgy21","updated":"20250605215017"},"Children":[{"Type":"NodeText","Data":"2. "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"性能分析"}]},{"ID":"20250605215017-2ze30uy","Type":"NodeList","ListData":{},"Properties":{"id":"20250605215017-2ze30uy","updated":"20250605215017"},"Children":[{"ID":"20250605215017-fb7dku0","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250605215017-fb7dku0","updated":"20250605215017"},"Children":[{"ID":"20250605215017-uqih2gj","Type":"NodeParagraph","Properties":{"id":"20250605215017-uqih2gj","updated":"20250605215017"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"函数调用耗时统计"},{"Type":"NodeText","Data":"：记录每个函数调用的进入和退出时间（如gprof、perf）"}]}]},{"ID":"20250605215017-nto0wi0","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250605215017-nto0wi0","updated":"20250605215017"},"Children":[{"ID":"20250605215017-4oyvmzr","Type":"NodeParagraph","Properties":{"id":"20250605215017-4oyvmzr","updated":"20250605215017"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"内存使用情况监控"},{"Type":"NodeText","Data":"：插桩追踪内存分配与释放，检测泄露（如Valgrind、Purify）"}]}]}]},{"ID":"20250605215017-ob6b4qv","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250605215017-ob6b4qv","updated":"20250605215017"},"Children":[{"Type":"NodeText","Data":"3. "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"错误检测"}]},{"ID":"20250605215017-v66tpi1","Type":"NodeList","ListData":{},"Properties":{"id":"20250605215017-v66tpi1","updated":"20250605215017"},"Children":[{"ID":"20250605215017-r8sr5k9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250605215017-r8sr5k9","updated":"20250605215017"},"Children":[{"ID":"20250605215017-cccsok2","Type":"NodeParagraph","Properties":{"id":"20250605215017-cccsok2","updated":"20250605215017"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"数据流插桩"},{"Type":"NodeText","Data":"：分析变量的定义-使用链，检测未初始化变量或死代码"}]}]},{"ID":"20250605215017-t8301sz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250605215017-t8301sz","updated":"20250605215017"},"Children":[{"ID":"20250605215017-zsk9xx9","Type":"NodeParagraph","Properties":{"id":"20250605215017-zsk9xx9","updated":"20250605215017"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"运行时异常检测"},{"Type":"NodeText","Data":"：如数组越界、空指针引用、资源未释放等"}]}]}]},{"ID":"20250605215017-x2qimy6","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250605215017-x2qimy6","updated":"20250605215017"},"Children":[{"Type":"NodeText","Data":"4. "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"安全审计"}]},{"ID":"20250605215017-br570qo","Type":"NodeList","ListData":{},"Properties":{"id":"20250605215017-br570qo","updated":"20250605215017"},"Children":[{"ID":"20250605215017-09kkqhu","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250605215017-09kkqhu","updated":"20250605215017"},"Children":[{"ID":"20250605215017-4jt5byc","Type":"NodeParagraph","Properties":{"id":"20250605215017-4jt5byc","updated":"20250605215017"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"系统调用跟踪"},{"Type":"NodeText","Data":"：监控关键系统调用（如open, exec, socket），发现异常行为（如Strace）"}]}]},{"ID":"20250605215017-kjnzvtk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250605215017-kjnzvtk","updated":"20250605215017"},"Children":[{"ID":"20250605215017-e6hwztv","Type":"NodeParagraph","Properties":{"id":"20250605215017-e6hwztv","updated":"20250605215017"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"插入检查点"},{"Type":"NodeText","Data":"：检测输入合法性，缓冲区溢出预防"}]}]}]},{"ID":"20250605215017-o8i8bdf","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250605215017-o8i8bdf","updated":"20250605215017"},"Children":[{"Type":"NodeText","Data":"5. "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"程序理解与调试"}]},{"ID":"20250605215017-1r9n5qn","Type":"NodeList","ListData":{},"Properties":{"id":"20250605215017-1r9n5qn","updated":"20250605215017"},"Children":[{"ID":"20250605215017-bmrranj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250605215017-bmrranj","updated":"20250605215017"},"Children":[{"ID":"20250605215017-m23thgq","Type":"NodeParagraph","Properties":{"id":"20250605215017-m23thgq","updated":"20250605215017"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"日志收集"},{"Type":"NodeText","Data":"：插桩用于记录关键变量、状态变化，用于问题重现"}]}]},{"ID":"20250605215017-nd5fyqk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250605215017-nd5fyqk","updated":"20250605215017"},"Children":[{"ID":"20250605215017-mzk4yvt","Type":"NodeParagraph","Properties":{"id":"20250605215017-mzk4yvt","updated":"20250605215017"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"代码可视化"},{"Type":"NodeText","Data":"：结合可视化工具（如D3.js）实现函数调用图、依赖图等"}]}]}]},{"ID":"20250605215017-ca2ecf4","Type":"NodeThematicBreak","Properties":{"id":"20250605215017-ca2ecf4","updated":"20250605215017"}},{"ID":"20250605215017-c9t3c9k","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250605215017-c9t3c9k","updated":"20250605215017"},"Children":[{"Type":"NodeText","Data":"四、插桩工具示例"}]},{"ID":"20250605215017-v0s303r","Type":"NodeTable","TableAligns":[0,0,0,0],"Properties":{"colgroup":"|||","id":"20250605215017-v0s303r","updated":"20250605215017"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"工具"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"语言"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"类型"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"用途"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Gcov"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"C/C++"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"源码级"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"代码覆盖率分析"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"JaCoCo"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"Java"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"字节码级"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"Java代码覆盖率"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"AspectJ"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"Java"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"字节码级"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"AOP切面式插桩"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Pin / DynamoRIO"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"C/C++"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"运行时二进制插桩"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"动态分析、调试"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Valgrind"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"C/C++"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"二进制"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"内存泄漏检测"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"LLVM Pass"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"C/C++"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"中间码（IR）级"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"静态/动态分析"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Frida"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"多语言"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"动态"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"安全、逆向分析工具"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"DTrace / SystemTap"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"C系统调用"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"内核/用户空间"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"性能与安全分析"}]}]}]}]}