{"ID":"20250516115816-sho12gw","Spec":"1","Type":"NodeDocument","Properties":{"id":"20250516115816-sho12gw","title":"性能测试结果分析","type":"doc","updated":"20250516120207"},"Children":[{"ID":"20250516115840-yuucg0c","Type":"NodeParagraph","Properties":{"id":"20250516115840-yuucg0c","updated":"20250516120154"},"Children":[{"Type":"NodeText","Data":"可视化：使用工具"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://www.speedscope.app/","TextMarkTextContent":"speedscope"},{"Type":"NodeText","Data":"或"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://ui.perfetto.dev/","TextMarkTextContent":"Perfetto UI"},{"Type":"NodeText","Data":"对python进程生成json图，并在https://www.speedscope.app/页面查看可视化结果"}]},{"ID":"20250516115901-tghr6og","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250516115901-tghr6og","updated":"20250516120207"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Y21k"},{"Type":"NodeCodeBlockCode","Data":"# speedscope\npip install py-spy \npy-spy record --format speedscope -o profile.json -- python your_script.py\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250516115818-u1soe8y","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250516115818-u1soe8y","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"分析实验结果的步骤"}]},{"ID":"20250516115818-siydnsl","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250516115818-siydnsl","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"1️⃣ 找出最耗时函数（热点函数）"}]},{"ID":"20250516115818-l88s3qt","Type":"NodeList","ListData":{},"Properties":{"id":"20250516115818-l88s3qt","updated":"20250516115818"},"Children":[{"ID":"20250516115818-294xadn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250516115818-294xadn","updated":"20250516115818"},"Children":[{"ID":"20250516115818-xedw1ti","Type":"NodeParagraph","Properties":{"id":"20250516115818-xedw1ti","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"切换到 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Left Heavy"},{"Type":"NodeText","Data":" 模式。"}]}]},{"ID":"20250516115818-5vikgh9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250516115818-5vikgh9","updated":"20250516115818"},"Children":[{"ID":"20250516115818-wxv3rno","Type":"NodeParagraph","Properties":{"id":"20250516115818-wxv3rno","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"查看最左侧的函数堆栈，这些函数往往是占用 CPU 时间最多的。"}]}]},{"ID":"20250516115818-3i605a2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250516115818-3i605a2","updated":"20250516115818"},"Children":[{"ID":"20250516115818-x2p2fub","Type":"NodeParagraph","Properties":{"id":"20250516115818-x2p2fub","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"记录这些函数的："}]},{"ID":"20250516115818-rxjuktr","Type":"NodeList","ListData":{},"Properties":{"id":"20250516115818-rxjuktr","updated":"20250516115818"},"Children":[{"ID":"20250516115818-8q3i73r","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250516115818-8q3i73r","updated":"20250516115818"},"Children":[{"ID":"20250516115818-nz4gjyp","Type":"NodeParagraph","Properties":{"id":"20250516115818-nz4gjyp","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"名称"}]}]},{"ID":"20250516115818-priw7e6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250516115818-priw7e6","updated":"20250516115818"},"Children":[{"ID":"20250516115818-5d4faa3","Type":"NodeParagraph","Properties":{"id":"20250516115818-5d4faa3","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"所属模块/包"}]}]},{"ID":"20250516115818-sjonxuk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250516115818-sjonxuk","updated":"20250516115818"},"Children":[{"ID":"20250516115818-my5rymc","Type":"NodeParagraph","Properties":{"id":"20250516115818-my5rymc","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"所处调用栈层级"}]}]},{"ID":"20250516115818-l3gcbzc","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250516115818-l3gcbzc","updated":"20250516115818"},"Children":[{"ID":"20250516115818-a6g6lc0","Type":"NodeParagraph","Properties":{"id":"20250516115818-a6g6lc0","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"占用的采样比例（越宽越高）"}]}]}]}]}]},{"ID":"20250516115818-aw7irvt","Type":"NodeParagraph","Properties":{"id":"20250516115818-aw7irvt","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"💡 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"实验分析例子"},{"Type":"NodeText","Data":"："}]},{"ID":"20250516115818-a38f54w","Type":"NodeBlockquote","Properties":{"id":"20250516115818-a38f54w","updated":"20250516115818"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20250516115818-zlapgj8","Type":"NodeParagraph","Properties":{"id":"20250516115818-zlapgj8","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"“我们发现 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"torch.nn.functional.conv2d"},{"Type":"NodeText","Data":"​ 占据了整个执行时间的 36%，表明卷积计算是当前模型前向推理的性能瓶颈。”"}]}]},{"ID":"20250516115818-q4e7bbg","Type":"NodeThematicBreak","Properties":{"id":"20250516115818-q4e7bbg","updated":"20250516115818"}},{"ID":"20250516115818-us5r5f8","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250516115818-us5r5f8","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"2️⃣ 分析调用路径（调用链条）"}]},{"ID":"20250516115818-97tpavs","Type":"NodeList","ListData":{},"Properties":{"id":"20250516115818-97tpavs","updated":"20250516115818"},"Children":[{"ID":"20250516115818-e9r9gsn","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250516115818-e9r9gsn","updated":"20250516115818"},"Children":[{"ID":"20250516115818-uljlfox","Type":"NodeParagraph","Properties":{"id":"20250516115818-uljlfox","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"点击某个热点函数，观察其上游和下游调用栈。"}]}]},{"ID":"20250516115818-cd8ajc3","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250516115818-cd8ajc3","updated":"20250516115818"},"Children":[{"ID":"20250516115818-e8k7nhv","Type":"NodeParagraph","Properties":{"id":"20250516115818-e8k7nhv","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"确定这个函数是被谁频繁调用的，是否存在重复的、不必要的调用路径。"}]}]},{"ID":"20250516115818-dt3qstf","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250516115818-dt3qstf","updated":"20250516115818"},"Children":[{"ID":"20250516115818-int45sx","Type":"NodeParagraph","Properties":{"id":"20250516115818-int45sx","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"识别是否存在深层嵌套调用，可能说明模块拆分不合理。"}]}]}]},{"ID":"20250516115818-9fbro1h","Type":"NodeParagraph","Properties":{"id":"20250516115818-9fbro1h","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"💡 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"实验分析例子"},{"Type":"NodeText","Data":"："}]},{"ID":"20250516115818-rq9pcr8","Type":"NodeBlockquote","Properties":{"id":"20250516115818-rq9pcr8","updated":"20250516115818"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20250516115818-x8jhwex","Type":"NodeParagraph","Properties":{"id":"20250516115818-x8jhwex","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"“进一步追踪调用栈，我们发现 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"load_data → preprocess → resize → cv2.resize"},{"Type":"NodeText","Data":"​ 的链条在每次批次中都被重复调用，说明数据预处理阶段存在显著重复计算。”"}]}]},{"ID":"20250516115818-i69ql1a","Type":"NodeThematicBreak","Properties":{"id":"20250516115818-i69ql1a","updated":"20250516115818"}},{"ID":"20250516115818-fwnf9tg","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250516115818-fwnf9tg","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"3️⃣ 检查执行时间变化（时间分布）"}]},{"ID":"20250516115818-m4u26w5","Type":"NodeList","ListData":{},"Properties":{"id":"20250516115818-m4u26w5","updated":"20250516115818"},"Children":[{"ID":"20250516115818-ug1xkfo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250516115818-ug1xkfo","updated":"20250516115818"},"Children":[{"ID":"20250516115818-pw6yoc1","Type":"NodeParagraph","Properties":{"id":"20250516115818-pw6yoc1","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"切换到 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Time Order"},{"Type":"NodeText","Data":" 模式。"}]}]},{"ID":"20250516115818-avugz9l","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250516115818-avugz9l","updated":"20250516115818"},"Children":[{"ID":"20250516115818-qqwxfb9","Type":"NodeParagraph","Properties":{"id":"20250516115818-qqwxfb9","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"检查是否存在："}]},{"ID":"20250516115818-43c80ch","Type":"NodeList","ListData":{},"Properties":{"id":"20250516115818-43c80ch","updated":"20250516115818"},"Children":[{"ID":"20250516115818-73smmpw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250516115818-73smmpw","updated":"20250516115818"},"Children":[{"ID":"20250516115818-ecqpxh0","Type":"NodeParagraph","Properties":{"id":"20250516115818-ecqpxh0","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"周期性波动（比如内存回收、批处理）"}]}]},{"ID":"20250516115818-cow2zad","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250516115818-cow2zad","updated":"20250516115818"},"Children":[{"ID":"20250516115818-4vz9m53","Type":"NodeParagraph","Properties":{"id":"20250516115818-4vz9m53","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"突发抖动（如某一步骤特别耗时）"}]}]},{"ID":"20250516115818-m6t6cas","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250516115818-m6t6cas","updated":"20250516115818"},"Children":[{"ID":"20250516115818-snkgq8j","Type":"NodeParagraph","Properties":{"id":"20250516115818-snkgq8j","updated":"20250516115818"},"Children":[{"Type":"NodeText","Data":"空闲区段（表示等待或阻塞）"}]}]}]}]}]}]}